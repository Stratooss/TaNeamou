<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <title>Î†ÏÎ¸ÏÎ¿ - Î•ÏÎºÎ¿Î»ÎµÏ‚ Î•Î¹Î´Î®ÏƒÎµÎ¹Ï‚</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: #e5e7eb;
      font-size: 18px;
      line-height: 1.6;
    }

    .site-header {
      background: #1d4ed8;
      color: white;
      padding: 1rem 0;
      margin-bottom: 1.2rem;
      box-shadow: 0 2px 8px rgba(15, 23, 42, 0.3);
    }

    .site-title {
      font-size: 1.6rem;
      font-weight: 800;
    }

    .page-wrapper {
      max-width: 800px;
      margin: 0 auto;
    }

    .article-main-card {
      border-radius: 20px;
      background-color: #ffffff;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.15);
      padding: 1.2rem 1.4rem;
    }

    .article-main-title {
      font-size: 1.5rem;
      font-weight: 800;
      margin-bottom: 0.8rem;
      color: #111827;
    }

    .article-image-wrapper {
      width: 100%;
      aspect-ratio: 16 / 9;
      background-color: #e5e7eb;
      overflow: hidden;
      border-radius: 16px;
      margin-bottom: 1rem;
    }

    .article-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Î’Î¯Î½Ï„ÎµÎ¿ Î¬ÏÎ¸ÏÎ¿Ï… */
    .article-video-wrapper {
      width: 100%;
      margin-bottom: 1rem;
    }

    .article-video {
      width: 100%;
      aspect-ratio: 16 / 9;
      border-radius: 16px;
      border: none;
      background-color: #000;
      display: block;
    }

    .article-body {
      font-size: 1.05rem;
      color: #111827;
      margin-bottom: 1rem;
    }

    .source {
      font-size: 0.95rem;
      color: #4b5563;
    }

    .btn-listen {
      font-size: 0.98rem;
      border-radius: 999px;
      padding-inline: 1.2rem;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container page-wrapper d-flex justify-content-between align-items-center">
      <div class="site-title">ğŸ“° Î•ÏÎºÎ¿Î»ÎµÏ‚ Î•Î¹Î´Î®ÏƒÎµÎ¹Ï‚</div>
      <a href="index.html" class="btn btn-sm btn-light">
        â† Î Î¯ÏƒÏ‰ ÏƒÏ„Î¹Ï‚ ÎµÎ¹Î´Î®ÏƒÎµÎ¹Ï‚
      </a>
    </div>
  </header>

  <main class="container mb-5">
    <div class="page-wrapper">
      <article class="article-main-card">
        <h1 id="article-title" class="article-main-title">Î¦Î¿ÏÏ„ÏÎ½Ï‰ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿â€¦</h1>

        <!-- Î•Î¹ÎºÏŒÎ½Î± Î¬ÏÎ¸ÏÎ¿Ï… -->
        <div id="article-image-wrapper" class="article-image-wrapper" style="display:none;">
          <img id="article-image" class="article-image" alt="Î•Î¹ÎºÏŒÎ½Î± Î¬ÏÎ¸ÏÎ¿Ï…" />
        </div>

        <!-- Î’Î¯Î½Ï„ÎµÎ¿ Î¬ÏÎ¸ÏÎ¿Ï… (iframe Î® <video>) -->
        <div id="article-video-wrapper" class="article-video-wrapper" style="display:none;">
          <div id="article-video-container"></div>
        </div>

        <div id="article-body" class="article-body">
          Î Î±ÏÎ±ÎºÎ±Î»Ï Ï€ÎµÏÎ¯Î¼ÎµÎ½Îµ Î»Î¯Î³Î¿â€¦
        </div>

        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2 mt-3">
          <p id="article-source" class="source mb-0"></p>
          <button id="listen-btn" type="button" class="btn btn-primary btn-listen">
            Î†ÎºÎ¿Ï… Ï„Î·Î½ ÎµÎ¯Î´Î·ÏƒÎ·
          </button>
        </div>
      </article>
    </div>
  </main>

  <script>
    function cleanMarkdown(text) {
      if (!text) return "";
      return text
        .replace(/\*\*(.+?)\*\*/g, "$1")
        .replace(/###\s*/g, "")
        .trim();
    }

    function speak(text) {
      if (!("speechSynthesis" in window)) {
        alert("ÎŸ Ï€ÎµÏÎ¹Î·Î³Î·Ï„Î®Ï‚ Î´ÎµÎ½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Î±Î½Î¬Î³Î½Ï‰ÏƒÎ· ÎºÎµÎ¹Î¼Î­Î½Î¿Ï….");
        return;
      }
      window.speechSynthesis.cancel();
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "el-GR";
      window.speechSynthesis.speak(utterance);
    }

    async function loadArticle() {
      const params = new URLSearchParams(window.location.search);
      const idParam = params.get("id");

      const titleEl = document.getElementById("article-title");
      const bodyEl = document.getElementById("article-body");
      const sourceEl = document.getElementById("article-source");
      const imageWrapper = document.getElementById("article-image-wrapper");
      const imageEl = document.getElementById("article-image");
      const videoWrapper = document.getElementById("article-video-wrapper");
      const videoContainer = document.getElementById("article-video-container");
      const listenBtn = document.getElementById("listen-btn");

      if (!idParam) {
        titleEl.textContent = "Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿";
        bodyEl.textContent = "Î›ÎµÎ¯Ï€ÎµÎ¹ Ï„Î¿ Î±Î½Î±Î³Î½Ï‰ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï… (id).";
        listenBtn.disabled = true;
        return;
      }

      try {
        const res = await fetch("news.json?cachebust=" + Date.now());
        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }

        const data = await res.json();
        const articles = (data && data.articles) || [];

        let article = articles.find((a) => String(a.id) === String(idParam));

        if (!article) {
          const idx = Number(idParam);
          if (!Number.isNaN(idx) && idx >= 0 && idx < articles.length) {
            article = articles[idx];
          }
        }

        if (!article) {
          titleEl.textContent = "Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿";
          bodyEl.textContent = "ÎŠÏƒÏ‰Ï‚ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿ Î½Î± Î­Ï‡ÎµÎ¹ Î±Ï†Î±Î¹ÏÎµÎ¸ÎµÎ¯.";
          listenBtn.disabled = true;
          return;
        }

        const displayTitle = article.simpleTitle || article.title || "";
        const cleaned = cleanMarkdown(article.simpleText || "");

        titleEl.textContent = displayTitle;
        bodyEl.innerHTML = cleaned.replace(/\n/g, "<br/>");

        // Î•Î¹ÎºÏŒÎ½Î±
        if (article.imageUrl) {
          imageEl.src = article.imageUrl;
          imageEl.alt = displayTitle || "Î•Î¹ÎºÏŒÎ½Î± Î¬ÏÎ¸ÏÎ¿Ï…";
          imageWrapper.style.display = "block";
        }

        // Î’Î¯Î½Ï„ÎµÎ¿ (Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ videoUrl ÏƒÏ„Î¿ JSON)
        if (article.videoUrl) {
          let node;
          const url = article.videoUrl;

          // Î‘Î½ Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ ÏƒÎ±Î½ Î±ÏÏ‡ÎµÎ¯Î¿ Î²Î¯Î½Ï„ÎµÎ¿ (mp4, webm, ogg)
          if (/\.(mp4|webm|ogg)(\?|$)/i.test(url)) {
            node = document.createElement("video");
            node.className = "article-video";
            node.controls = true;

            const source = document.createElement("source");
            source.src = url;
            node.appendChild(source);
          } else {
            // Î‘Î»Î»Î¹ÏÏ‚ Ï„Î¿ Ï‡ÎµÎ¹ÏÎ¹Î¶ÏŒÎ¼Î±ÏƒÏ„Îµ ÏƒÎ±Î½ embed (iframe),
            // Ï€.Ï‡. YouTube, TruthSocial embed, Îº.Î»Ï€.
            node = document.createElement("iframe");
            node.className = "article-video";
            node.src = url;
            node.loading = "lazy";
            node.allowFullscreen = true;
            node.setAttribute("frameborder", "0");
            node.setAttribute(
              "allow",
              "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            );
          }

          videoContainer.appendChild(node);
          videoWrapper.style.display = "block";
        }

        const sourceName = article.sourceName || "Î Î·Î³Î®";
        const sourceUrl = article.sourceUrl || "#";
        sourceEl.innerHTML =
          'Î Î·Î³Î®: <a href="' +
          sourceUrl +
          '" target="_blank" rel="noopener noreferrer">' +
          sourceName +
          "</a>";

        document.title = displayTitle + " - Î•ÏÎºÎ¿Î»ÎµÏ‚ Î•Î¹Î´Î®ÏƒÎµÎ¹Ï‚";

        listenBtn.addEventListener("click", () => {
          const toRead = displayTitle + ". " + cleaned;
          speak(toRead);
        });
      } catch (err) {
        console.error(err);
        titleEl.textContent = "Î ÏÎ¿Î­ÎºÏ…ÏˆÎµ ÏƒÏ†Î¬Î»Î¼Î±";
        bodyEl.textContent = "Î”ÎµÎ½ Î¼Ï€ÏŒÏÎµÏƒÎ± Î½Î± Ï†Î¿ÏÏ„ÏÏƒÏ‰ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿: " + err.message;
        listenBtn.disabled = true;
      }
    }

    document.addEventListener("DOMContentLoaded", loadArticle);
  </script>
</body>
</html>
