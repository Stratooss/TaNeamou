<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <title>Î†ÏÎ¸ÏÎ¿ - Î•ÏÎºÎ¿Î»ÎµÏ‚ Î•Î¹Î´Î®ÏƒÎµÎ¹Ï‚</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: #e5e7eb;
      font-size: 18px;
      line-height: 1.6;
      position: relative;
    }

    /* Ï†Î»Î¿Ï… full-screen backround Î³Î¹Î± ÏƒÎ¿Î²Î±ÏÎ­Ï‚ ÎºÎ±Î¹ lifestyle ÎµÎ¹Î´Î®ÏƒÎµÎ¹Ï‚ */
    .article-bg {
      position: fixed;
      inset: 0;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 0.12;
      z-index: -1;
      filter: blur(1px);
    }

    .site-header {
      background: #1d4ed8;
      color: white;
      padding: 1rem 0;
      margin-bottom: 1.2rem;
      box-shadow: 0 2px 8px rgba(15, 23, 42, 0.3);
    }

    .site-title {
      font-size: 1.6rem;
      font-weight: 800;
    }

    .page-wrapper {
      max-width: 800px;
      margin: 0 auto;
    }

    .article-main-card {
      border-radius: 20px;
      background-color: #ffffff;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.15);
      padding: 1.2rem 1.4rem;
    }

    .article-main-title {
      font-size: 1.5rem;
      font-weight: 800;
      margin-bottom: 0.8rem;
      color: #111827;
      text-align: center;
    }

    .article-image-wrapper {
      width: 100%;
      aspect-ratio: 16 / 9;
      background-color: #e5e7eb;
      overflow: hidden;
      border-radius: 16px;
      margin-bottom: 1rem;
    }

    .article-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .article-video-wrapper {
      width: 100%;
      margin-bottom: 1rem;
    }

    .article-video {
      width: 100%;
      aspect-ratio: 16 / 9;
      border-radius: 16px;
      border: none;
      background-color: #000;
      display: block;
    }

    .article-body {
      font-size: 1.05rem;
      color: #111827;
      margin-bottom: 1rem;
    }

    .btn-listen {
      font-size: 0.98rem;
      border-radius: 999px;
      padding-inline: 1.2rem;
      font-weight: 600;
    }

    /* ğŸ” Î Î·Î³Î­Ï‚ ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚, Î¼Îµ "ÎµÎ¹ÎºÎ¿Î½Î¯Î´Î¹Î¿" */
    .source-block {
      margin-top: 0.9rem;
      font-size: 0.95rem;
      color: #4b5563;
    }

    .source-label {
      font-weight: 600;
      color: #374151;
      margin-bottom: 0.25rem;
    }

    .source-list {
      list-style: none;
      padding-left: 0;
      margin: 0.25rem 0 0;
    }

    .source-list li {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.95rem;
    }

    .source-icon {
      font-size: 1.1rem;
    }
  </style>
</head>
<body>
  <!-- full-screen background Î³Î¹Î± ÏƒÎ¿Î²Î±ÏÎ­Ï‚ & lifestyle ÎµÎ¹Î´Î®ÏƒÎµÎ¹Ï‚ -->
  <div id="article-bg" class="article-bg" style="display:none;"></div>

  <header class="site-header">
    <div class="container page-wrapper d-flex justify-content-between align-items-center">
      <div class="site-title">ğŸ“° Î•ÏÎºÎ¿Î»ÎµÏ‚ Î•Î¹Î´Î®ÏƒÎµÎ¹Ï‚</div>
      <a href="index.html" class="btn btn-sm btn-light">
        â† Î Î¯ÏƒÏ‰ ÏƒÏ„Î¹Ï‚ ÎµÎ¹Î´Î®ÏƒÎµÎ¹Ï‚
      </a>
    </div>
  </header>

  <main class="container mb-5">
    <div class="page-wrapper">
      <article class="article-main-card">
        <h1 id="article-title" class="article-main-title">Î¦Î¿ÏÏ„ÏÎ½Ï‰ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿â€¦</h1>

        <!-- Î•Î¹ÎºÏŒÎ½Î± Î¬ÏÎ¸ÏÎ¿Ï… Î±Ï€ÏŒ news.json -->
        <div id="article-image-wrapper" class="article-image-wrapper" style="display:none;">
          <img id="article-image" class="article-image" alt="Î•Î¹ÎºÏŒÎ½Î± Î¬ÏÎ¸ÏÎ¿Ï…" />
        </div>

        <!-- Î’Î¯Î½Ï„ÎµÎ¿ Î¬ÏÎ¸ÏÎ¿Ï… -->
        <div id="article-video-wrapper" class="article-video-wrapper" style="display:none;">
          <div id="article-video-container"></div>
        </div>

        <div id="article-body" class="article-body">
          Î Î±ÏÎ±ÎºÎ±Î»Ï Ï€ÎµÏÎ¯Î¼ÎµÎ½Îµ Î»Î¯Î³Î¿â€¦
        </div>

        <!-- ÎšÎ¿Ï…Î¼Ï€Î¯ Î±ÎºÏÏŒÎ±ÏƒÎ·Ï‚ -->
        <div class="d-flex justify-content-end mt-3">
          <button id="listen-btn" type="button" class="btn btn-primary btn-listen">
            Î†ÎºÎ¿Ï… Ï„Î·Î½ ÎµÎ¯Î´Î·ÏƒÎ·
          </button>
        </div>

        <!-- ğŸ”š Î Î·Î³Î­Ï‚ ÎœÎŸÎÎŸ ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚ -->
        <div id="article-source" class="source-block"></div>
      </article>
    </div>
  </main>

  <script>
    function escapeHtml(str) {
      if (!str) return "";
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }

    // Î‘Ï†Î±Î¹ÏÎ¿ÏÎ¼Îµ ÎŸÎ›Î•Î£ Ï„Î¹Ï‚ ÎµÎ½ÏŒÏ„Î·Ï„ÎµÏ‚ "Î Î·Î³Î­Ï‚" Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÎ¹ Î³ÏÎ¬ÏˆÎµÎ¹ Ï„Î¿ LLM
    function stripSourcesSection(text) {
      if (!text) return "";

      const lines = text.split(/\r?\n/);
      let firstSourcesIndex = -1;

      for (let i = 0; i < lines.length; i++) {
        const trimmed = lines[i].trim();
        // Î Î¹Î¬Î½Î¿Ï…Î¼Îµ Î³ÏÎ±Î¼Î¼Î­Ï‚ Ï„ÏÏ€Î¿Ï… "Î Î·Î³Î­Ï‚", "Î Î·Î³Î­Ï‚:", "**Î Î·Î³Î­Ï‚:**" ÎºÏ„Î».
        if (/^(\*+)?\s*Î Î·Î³Î­Ï‚:?/i.test(trimmed)) {
          firstSourcesIndex = i;
          break;
        }
      }

      if (firstSourcesIndex === -1) {
        return text;
      }

      return lines.slice(0, firstSourcesIndex).join("\n").trim();
    }

    function cleanMarkdown(text) {
      if (!text) return "";

      // 1) Î’Î³Î¬Î¶Î¿Ï…Î¼Îµ Î¿Ï„Î¹Î´Î®Ï€Î¿Ï„Îµ Î­ÏÏ‡ÎµÏ„Î±Î¹ Î¼ÎµÏ„Î¬ Ï„Î·Î½ Ï€ÏÏÏ„Î· Î³ÏÎ±Î¼Î¼Î® "Î Î·Î³Î­Ï‚"
      let cleaned = stripSourcesSection(text);

      // 2) Î’Î³Î¬Î¶Î¿Ï…Î¼Îµ markdown links: [Ï„Î¯Ï„Î»Î¿Ï‚](url) -> "Ï„Î¯Ï„Î»Î¿Ï‚"
      cleaned = cleaned.replace(
        /\[([^\]]+)\]\((https?:\/\/[^\s)]+)\)/g,
        "$1"
      );

      // 3) Î’Î³Î¬Î¶Î¿Ï…Î¼Îµ Î³Ï…Î¼Î½Î¬ urls Ï„ÏÏ€Î¿Ï… https://...
      cleaned = cleaned.replace(/https?:\/\/[^\s)]+/g, "");

      // 4) Î’Î³Î¬Î¶Î¿Ï…Î¼Îµ **bold** ÎºÎ±Î¹ ### headings
      cleaned = cleaned
        .replace(/\*\*(.+?)\*\*/g, "$1")
        .replace(/###\s*/g, "")
        .trim();

      return cleaned;
    }

    // ğŸ”Š ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Î³Î¹Î± play / pause / resume
    const ttsState = {
      utterance: null,
      isSpeaking: false,
      isPaused: false,
    };

    function setupTtsButton(buttonEl, title, bodyText) {
      const fullText = (title ? title + ". " : "") + (bodyText || "");

      buttonEl.textContent = "Î†ÎºÎ¿Ï… Ï„Î·Î½ ÎµÎ¯Î´Î·ÏƒÎ·";

      buttonEl.onclick = () => {
        if (!("speechSynthesis" in window)) {
          alert("ÎŸ Ï€ÎµÏÎ¹Î·Î³Î·Ï„Î®Ï‚ Î´ÎµÎ½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Î±Î½Î¬Î³Î½Ï‰ÏƒÎ· ÎºÎµÎ¹Î¼Î­Î½Î¿Ï….");
          return;
        }

        const synth = window.speechSynthesis;

        // Î±Î½ Î®Î´Î· Î¼Î¹Î»Î¬ÎµÎ¹ â†’ Ï€Î±ÏÏƒÎ·
        if (ttsState.isSpeaking && !ttsState.isPaused) {
          synth.pause();
          ttsState.isPaused = true;
          buttonEl.textContent = "Î£Ï…Î½Î­Ï‡Î¹ÏƒÎµ Ï„Î·Î½ ÎµÎ¯Î´Î·ÏƒÎ·";
          return;
        }

        // Î±Î½ ÎµÎ¯Î½Î±Î¹ ÏƒÎµ pause â†’ ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±
        if (ttsState.isSpeaking && ttsState.isPaused) {
          synth.resume();
          ttsState.isPaused = false;
          buttonEl.textContent = "Î Î±ÏÏƒÎ·";
          return;
        }

        // Î¾ÎµÎºÎ¹Î½Î¬Î¼Îµ Î½Î­Î± Î±Î½Î¬Î³Î½Ï‰ÏƒÎ·
        synth.cancel();
        const utterance = new SpeechSynthesisUtterance(fullText);
        utterance.lang = "el-GR";

        utterance.onstart = () => {
          ttsState.isSpeaking = true;
          ttsState.isPaused = false;
          buttonEl.textContent = "Î Î±ÏÏƒÎ·";
        };

        utterance.onend = () => {
          ttsState.isSpeaking = false;
          ttsState.isPaused = false;
          buttonEl.textContent = "Î†ÎºÎ¿Ï… Ï„Î·Î½ ÎµÎ¯Î´Î·ÏƒÎ·";
        };

        utterance.onerror = () => {
          ttsState.isSpeaking = false;
          ttsState.isPaused = false;
          buttonEl.textContent = "Î†ÎºÎ¿Ï… Ï„Î·Î½ ÎµÎ¯Î´Î·ÏƒÎ·";
        };

        ttsState.utterance = utterance;
        synth.speak(utterance);
      };
    }

    /* ---------- Background helpers ---------- */

    // ÏƒÎ¿Î²Î±ÏÎ­Ï‚ (digest) Î±Î½Î¬ topic
    function seriousBackgroundForTopic(topic) {
      switch (topic) {
        case "politics_economy":
          return "images/serious/politics.png";
        case "social":
          return "images/serious/social.png";
        case "world":
          return "images/serious/world.png";
        default:
          return null;
      }
    }

    function setSeriousBackground(topic) {
      const bgEl = document.getElementById("article-bg");
      if (!bgEl) return;
      const url = seriousBackgroundForTopic(topic);
      if (!url) {
        bgEl.style.display = "none";
        bgEl.style.backgroundImage = "";
        return;
      }
      bgEl.style.backgroundImage = "url('" + url + "')";
      bgEl.style.display = "block";
    }

    // lifestyle & Î±Ï€Î»Î­Ï‚ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚ Î±Î½Î¬ category
    function lifestyleBackgroundForCategory(category) {
      switch (category) {
        case "serious":
          return "images/categories/serious.jpg";
        case "sports":
          return "images/categories/sports.jpg";
        case "movies":
          return "images/categories/movies.jpg";
        case "series":
          return "images/categories/series.jpg";
        case "music":
          return "images/categories/music.jpg";
        case "theatre":
          return "images/categories/theatre.jpg";
        case "fun":
          return "images/categories/fun.jpg";
        case "other":
          return "images/categories/other.jpg";
        case "all":
          return "images/categories/all.jpg";
        default:
          return null;
      }
    }

    function setLifestyleBackground(category) {
      const bgEl = document.getElementById("article-bg");
      if (!bgEl) return;
      const url = lifestyleBackgroundForCategory(category);
      if (!url) {
        bgEl.style.display = "none";
        bgEl.style.backgroundImage = "";
        return;
      }
      bgEl.style.backgroundImage = "url('" + url + "')";
      bgEl.style.display = "block";
    }

    // ğŸ”š Î Î·Î³Î­Ï‚ ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚, Î¼Îµ ÎµÎ¹ÎºÎ¿Î½Î¯Î´Î¹Î¿
    function renderSourcesBlock(sourceEl, article, fallbackText) {
      if (!sourceEl) return;

      const sources = Array.isArray(article?.sources) ? article.sources : [];
      const fallbackName = article?.sourceName || null;
      const fallbackUrl = article?.sourceUrl || null;

      const items = [];

      if (sources.length) {
        for (const s of sources) {
          const name = s.sourceName || s.source || s.url || "Î Î·Î³Î®";
          const url = s.sourceUrl || s.url || null;
          items.push({ name, url });
        }
      } else if (fallbackUrl && fallbackUrl !== "#") {
        items.push({ name: fallbackName || "Î Î·Î³Î®", url: fallbackUrl });
      }

      if (!items.length && !fallbackText) {
        sourceEl.innerHTML = "";
        return;
      }

      let html = '<div class="source-label">Î Î·Î³Î­Ï‚</div><ul class="source-list">';

      if (items.length) {
        for (const item of items) {
          const safeName = escapeHtml(item.name || "Î Î·Î³Î®");
          if (item.url) {
            const safeUrl = escapeHtml(item.url);
            html +=
              '<li><span class="source-icon">ğŸŒ</span>' +
              '<a href="' +
              safeUrl +
              '" target="_blank" rel="noopener noreferrer">' +
              safeName +
              "</a></li>";
          } else {
            html +=
              '<li><span class="source-icon">ğŸŒ</span>' + safeName + "</li>";
          }
        }
      } else if (fallbackText) {
        html +=
          '<li><span class="source-icon">ğŸŒ</span>' +
          escapeHtml(fallbackText) +
          "</li>";
      }

      html += "</ul>";
      sourceEl.innerHTML = html;
    }

    async function loadNewsArticle({
      idParam,
      titleEl,
      bodyEl,
      sourceEl,
      imageWrapper,
      imageEl,
      videoWrapper,
      videoContainer,
      listenBtn,
    }) {
      if (!idParam) {
        titleEl.textContent = "Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿";
        bodyEl.textContent = "Î›ÎµÎ¯Ï€ÎµÎ¹ Ï„Î¿ Î±Î½Î±Î³Î½Ï‰ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï… (id).";
        listenBtn.disabled = true;
        return;
      }

      try {
        const res = await fetch("news.json?cachebust=" + Date.now());
        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }

        const data = await res.json();
        const articles = (data && data.articles) || [];

        let article = articles.find((a) => String(a.id) === String(idParam));

        if (!article) {
          const idx = Number(idParam);
          if (!Number.isNaN(idx) && idx >= 0 && idx < articles.length) {
            article = articles[idx];
          }
        }

        if (!article) {
          titleEl.textContent = "Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿";
          bodyEl.textContent = "ÎŠÏƒÏ‰Ï‚ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿ Î½Î± Î­Ï‡ÎµÎ¹ Î±Ï†Î±Î¹ÏÎµÎ¸ÎµÎ¯.";
          listenBtn.disabled = true;
          return;
        }

        const displayTitle = article.simpleTitle || article.title || "";
        const cleaned = cleanMarkdown(article.simpleText || "");

        // lifestyle / Î±Ï€Î»Î­Ï‚ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚ background
        if (article.category) {
          setLifestyleBackground(article.category);
        }

        titleEl.textContent = displayTitle;
        bodyEl.innerHTML = cleaned.replace(/\n/g, "<br/>");

        // Î•Î¹ÎºÏŒÎ½Î±
        if (article.imageUrl) {
          imageEl.src = article.imageUrl;
          imageEl.alt = displayTitle || "Î•Î¹ÎºÏŒÎ½Î± Î¬ÏÎ¸ÏÎ¿Ï…";
          imageWrapper.style.display = "block";
        }

        // Î’Î¯Î½Ï„ÎµÎ¿ (Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ videoUrl)
        if (article.videoUrl) {
          let node;
          const url = article.videoUrl;

          if (/\.(mp4|webm|ogg)(\?|$)/i.test(url)) {
            node = document.createElement("video");
            node.className = "article-video";
            node.controls = true;

            const source = document.createElement("source");
            source.src = url;
            node.appendChild(source);
          } else {
            node = document.createElement("iframe");
            node.className = "article-video";
            node.src = url;
            node.loading = "lazy";
            node.allowFullscreen = true;
            node.setAttribute("frameborder", "0");
            node.setAttribute(
              "allow",
              "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            );
          }

          videoContainer.appendChild(node);
          videoWrapper.style.display = "block";
        }

        // ğŸ”š Î Î·Î³Î­Ï‚ ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚
        renderSourcesBlock(sourceEl, article, null);

        document.title = displayTitle + " - Î•ÏÎºÎ¿Î»ÎµÏ‚ Î•Î¹Î´Î®ÏƒÎµÎ¹Ï‚";

        // ğŸ§ setup play / pause / resume
        setupTtsButton(listenBtn, displayTitle, cleaned);
      } catch (err) {
        console.error(err);
        titleEl.textContent = "Î ÏÎ¿Î­ÎºÏ…ÏˆÎµ ÏƒÏ†Î¬Î»Î¼Î±";
        bodyEl.textContent = "Î”ÎµÎ½ Î¼Ï€ÏŒÏÎµÏƒÎ± Î½Î± Ï†Î¿ÏÏ„ÏÏƒÏ‰ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿: " + err.message;
        listenBtn.disabled = true;
      }
    }

    async function loadSeriousArticle({
      idParam,
      topicParam,
      titleEl,
      bodyEl,
      sourceEl,
      listenBtn,
    }) {
      try {
        const digestRes = await fetch(
          "serious-digest.json?cachebust=" + Date.now()
        );
        if (!digestRes.ok) {
          throw new Error("HTTP " + digestRes.status);
        }
        const digestData = await digestRes.json();
        const digestArticles = Array.isArray(digestData.articles)
          ? digestData.articles
          : [];

        if (!digestArticles.length) {
          titleEl.textContent = "Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ ÏƒÎ¿Î²Î±ÏÎ­Ï‚ ÎµÎ¹Î´Î®ÏƒÎµÎ¹Ï‚";
          bodyEl.textContent =
            "Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Î¬ÏÎ¸ÏÎ¿ ÏƒÎ¿Î²Î±ÏÎ®Ï‚ ÎµÏ€Î¹ÎºÎ±Î¹ÏÏŒÏ„Î·Ï„Î±Ï‚ Î±Ï…Ï„Î® Ï„Î· ÏƒÏ„Î¹Î³Î¼Î®.";
          listenBtn.disabled = true;
          return;
        }

        let article = null;

        if (idParam) {
          article = digestArticles.find(
            (a) => String(a.id) === String(idParam)
          );
        }
        if (!article && topicParam) {
          article = digestArticles.find((a) => a.topic === topicParam);
        }
        if (!article) {
          article = digestArticles[0];
        }

        const displayTitle = article.title || "Î£Î¿Î²Î±ÏÎ® ÎµÎ¯Î´Î·ÏƒÎ·";
        const cleaned = cleanMarkdown(article.simpleText || "");

        // background Î±Î½Î¬ topic (serious digest)
        if (article.topic) {
          setSeriousBackground(article.topic);
        }

        titleEl.textContent = displayTitle;
        bodyEl.innerHTML = cleaned.replace(/\n/g, "<br/>");

        // Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î¿ÏÎ¼Îµ Î½Î± Î²ÏÎ¿ÏÎ¼Îµ Ï€Î·Î³Î­Ï‚ Î±Ï€ÏŒ Ï„Î¿ news.json (mainArticleId)
        if (article.mainArticleId) {
          try {
            const newsRes = await fetch("news.json?cachebust=" + Date.now());
            if (newsRes.ok) {
              const newsData = await newsRes.json();
              const allNews = Array.isArray(newsData.articles)
                ? newsData.articles
                : [];
              const mainSourceArticle = allNews.find(
                (a) => String(a.id) === String(article.mainArticleId)
              );
              if (mainSourceArticle) {
                renderSourcesBlock(sourceEl, mainSourceArticle, null);
              } else {
                renderSourcesBlock(
                  sourceEl,
                  { sources: [] },
                  "Î’Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÎµ Ï€Î¿Î»Î»Î­Ï‚ ÎµÎ»Î»Î·Î½Î¹ÎºÎ­Ï‚ ÎµÎ¹Î´Î·ÏƒÎµÎ¿Î³ÏÎ±Ï†Î¹ÎºÎ­Ï‚ Ï€Î·Î³Î­Ï‚."
                );
              }
            } else {
              renderSourcesBlock(
                sourceEl,
                { sources: [] },
                "Î’Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÎµ Ï€Î¿Î»Î»Î­Ï‚ ÎµÎ»Î»Î·Î½Î¹ÎºÎ­Ï‚ ÎµÎ¹Î´Î·ÏƒÎµÎ¿Î³ÏÎ±Ï†Î¹ÎºÎ­Ï‚ Ï€Î·Î³Î­Ï‚."
              );
            }
          } catch (e) {
            console.error("Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ news.json Î³Î¹Î± Ï„Î¹Ï‚ Ï€Î·Î³Î­Ï‚:", e);
            renderSourcesBlock(
              sourceEl,
              { sources: [] },
              "Î’Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÎµ Ï€Î¿Î»Î»Î­Ï‚ ÎµÎ»Î»Î·Î½Î¹ÎºÎ­Ï‚ ÎµÎ¹Î´Î·ÏƒÎµÎ¿Î³ÏÎ±Ï†Î¹ÎºÎ­Ï‚ Ï€Î·Î³Î­Ï‚."
            );
          }
        } else {
          renderSourcesBlock(
            sourceEl,
            { sources: [] },
            "Î’Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÎµ Ï€Î¿Î»Î»Î­Ï‚ ÎµÎ»Î»Î·Î½Î¹ÎºÎ­Ï‚ ÎµÎ¹Î´Î·ÏƒÎµÎ¿Î³ÏÎ±Ï†Î¹ÎºÎ­Ï‚ Ï€Î·Î³Î­Ï‚."
          );
        }

        document.title = displayTitle + " - Î•ÏÎºÎ¿Î»ÎµÏ‚ Î•Î¹Î´Î®ÏƒÎµÎ¹Ï‚";

        // ğŸ§ setup play / pause / resume
        setupTtsButton(listenBtn, displayTitle, cleaned);
      } catch (err) {
        console.error(err);
        titleEl.textContent = "Î ÏÎ¿Î­ÎºÏ…ÏˆÎµ ÏƒÏ†Î¬Î»Î¼Î±";
        bodyEl.textContent =
          "Î”ÎµÎ½ Î¼Ï€ÏŒÏÎµÏƒÎ± Î½Î± Ï†Î¿ÏÏ„ÏÏƒÏ‰ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿ ÏƒÎ¿Î²Î±ÏÎ®Ï‚ ÎµÏ€Î¹ÎºÎ±Î¹ÏÏŒÏ„Î·Ï„Î±Ï‚: " +
          err.message;
        listenBtn.disabled = true;
      }
    }

    async function loadLifestyleArticle({
      idParam,
      categoryParam,
      titleEl,
      bodyEl,
      sourceEl,
      listenBtn,
    }) {
      try {
        const res = await fetch("lifestyle.json?cachebust=" + Date.now());
        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }
        const data = await res.json();
        const list = Array.isArray(data.articles) ? data.articles : [];

        if (!list.length) {
          titleEl.textContent = "Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ lifestyle ÎµÎ¹Î´Î®ÏƒÎµÎ¹Ï‚";
          bodyEl.textContent =
            "Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Î¬ÏÎ¸ÏÎ¿ Î³Î¹Î± Î±Ï…Ï„Î® Ï„Î·Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î± Î±Ï…Ï„Î® Ï„Î· ÏƒÏ„Î¹Î³Î¼Î®.";
          listenBtn.disabled = true;
          return;
        }

        let article = null;

        if (idParam) {
          article = list.find((a) => String(a.id) === String(idParam));
        }
        if (!article && categoryParam) {
          article = list.find((a) => a.category === categoryParam);
        }
        if (!article) {
          article = list[0];
        }

        const displayTitle = article.title || "Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· ÏƒÎµ Î±Ï€Î»Î¬ Î»ÏŒÎ³Î¹Î±";
        const cleaned = cleanMarkdown(article.simpleText || "");

        if (article.category) {
          setLifestyleBackground(article.category);
        }

        titleEl.textContent = displayTitle;
        bodyEl.innerHTML = cleaned.replace(/\n/g, "<br/>");

        renderSourcesBlock(sourceEl, article, null);

        document.title = displayTitle + " - Î•ÏÎºÎ¿Î»ÎµÏ‚ Î•Î¹Î´Î®ÏƒÎµÎ¹Ï‚";

        setupTtsButton(listenBtn, displayTitle, cleaned);
      } catch (err) {
        console.error(err);
        titleEl.textContent = "Î ÏÎ¿Î­ÎºÏ…ÏˆÎµ ÏƒÏ†Î¬Î»Î¼Î±";
        bodyEl.textContent =
          "Î”ÎµÎ½ Î¼Ï€ÏŒÏÎµÏƒÎ± Î½Î± Ï†Î¿ÏÏ„ÏÏƒÏ‰ Ï„Î¿ lifestyle Î¬ÏÎ¸ÏÎ¿: " + err.message;
        listenBtn.disabled = true;
      }
    }

    async function loadArticle() {
      const params = new URLSearchParams(window.location.search);
      const source = params.get("source") || "news";
      const idParam = params.get("id");
      const topicParam = params.get("topic");
      const categoryParam = params.get("category");

      const titleEl = document.getElementById("article-title");
      const bodyEl = document.getElementById("article-body");
      const sourceEl = document.getElementById("article-source");
      const imageWrapper = document.getElementById("article-image-wrapper");
      const imageEl = document.getElementById("article-image");
      const videoWrapper = document.getElementById("article-video-wrapper");
      const videoContainer = document.getElementById("article-video-container");
      const listenBtn = document.getElementById("listen-btn");

      if (source === "serious") {
        await loadSeriousArticle({
          idParam,
          topicParam,
          titleEl,
          bodyEl,
          sourceEl,
          listenBtn,
        });
      } else if (source === "lifestyle") {
        await loadLifestyleArticle({
          idParam,
          categoryParam,
          titleEl,
          bodyEl,
          sourceEl,
          listenBtn,
        });
      } else {
        await loadNewsArticle({
          idParam,
          titleEl,
          bodyEl,
          sourceEl,
          imageWrapper,
          imageEl,
          videoWrapper,
          videoContainer,
          listenBtn,
        });
      }
    }

    document.addEventListener("DOMContentLoaded", loadArticle);
  </script>
</body>
</html>


