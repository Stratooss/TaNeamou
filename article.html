<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <title>Î†ÏÎ¸ÏÎ¿ - Î•ÏÎºÎ¿Î»Î± ÎÎ­Î±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />

  <style>
    :root {
      --bg: #020617;
      --card-bg: #111827;
      --card-border: rgba(148, 163, 184, 0.3);
      --accent: #60a5fa;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: var(--bg);
      color: var(--text-main);
      font-size: 18px;
      line-height: 1.75;
      position: relative;
      margin: 0;
    }

    a {
      color: var(--accent);
      text-decoration: none;
    }

    a:hover {
      color: #93c5fd;
    }

    /* Ï†Î»Î¿Ï… full-screen backround Î³Î¹Î± ÏƒÎ¿Î²Î±ÏÎ­Ï‚ & lifestyle ÎµÎ¹Î´Î®ÏƒÎµÎ¹Ï‚ */
    .article-bg {
      position: fixed;
      inset: 0;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 0.12;
      z-index: -1;
      filter: blur(1px);
    }

    .site-header {
      background: #0b1224;
      color: var(--text-main);
      padding: 1.6rem 0;
      margin-bottom: 1.6rem;
      border-bottom: 1px solid var(--card-border);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.28);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .site-header-inner {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }

    .site-header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.8rem;
      flex-wrap: wrap;
      width: 100%;
    }

    .site-title {
      font-size: 2rem;
      font-weight: 800;
      letter-spacing: 0.3px;
    }

    .site-subtitle {
      font-size: 1rem;
      color: var(--text-muted);
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.45rem 0.95rem;
      border-radius: 999px;
      border: 1px solid var(--card-border);
      color: var(--text-main);
      text-decoration: none;
      font-weight: 700;
      background: transparent;
    }

    .back-link:hover {
      color: #f8fafc;
      border-color: rgba(96, 165, 250, 0.7);
      background: rgba(96, 165, 250, 0.08);
    }

    .page-wrapper {
      max-width: 820px;
      margin: 0 auto;
    }

    .article-main-card {
      border-radius: 20px;
      background: var(--card-bg);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
      padding: 1.4rem 1.5rem;
      border: 1px solid var(--card-border);
    }

    .article-main-title {
      font-size: 1.6rem;
      font-weight: 800;
      margin-bottom: 1rem;
      color: var(--text-main);
      text-align: center;
      letter-spacing: 0.05px;
    }

    .article-image-wrapper {
      width: 100%;
      aspect-ratio: 16 / 9;
      background-color: #0f172a;
      overflow: hidden;
      border-radius: 16px;
      margin-bottom: 1rem;
      border: 1px solid var(--card-border);
    }

    .article-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .article-video-wrapper {
      width: 100%;
      margin-bottom: 1rem;
    }

    .article-video {
      width: 100%;
      aspect-ratio: 16 / 9;
      border-radius: 16px;
      border: none;
      background-color: #000;
      display: block;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.32);
    }

    .article-body {
      font-size: 1.08rem;
      color: var(--text-main);
      margin-bottom: 1rem;
      line-height: 1.85;
    }

    .article-body br {
      line-height: 1.2;
    }

    .btn-listen {
      font-size: 0.98rem;
      border-radius: 999px;
      padding-inline: 1.2rem;
      font-weight: 700;
      background: var(--accent);
      border: 1px solid var(--accent);
      color: #0b1224;
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.25);
    }

    .btn-listen:hover {
      background: #93c5fd;
      border-color: #93c5fd;
      color: #0b1224;
    }

    /* ğŸ” Î•Î½ÏŒÏ„Î·Ï„Î± Ï€Î·Î³ÏÎ½ Î¼Îµ Î±Ï€Î»Î® Î»Î¯ÏƒÏ„Î± */
    .sources-box {
      margin-top: 1.25rem;
      padding-top: 0.5rem;
      border-top: 1px solid var(--card-border);
    }

    .sources-box p {
      color: var(--text-muted);
      margin-bottom: 0.35rem;
      font-size: 0.95rem;
    }

    .sources-box ul {
      padding-left: 1rem;
      margin: 0;
      color: var(--text-main);
      font-size: 0.98rem;
      line-height: 1.5;
    }

    .sources-box li {
      margin-bottom: 0.2rem;
    }
  </style>
</head>
<body>
  <!-- full-screen background Î³Î¹Î± ÏƒÎ¿Î²Î±ÏÎ­Ï‚ & lifestyle ÎµÎ¹Î´Î®ÏƒÎµÎ¹Ï‚ -->
  <div id="article-bg" class="article-bg" style="display:none;"></div>

  <header class="site-header">
    <div class="container">
      <div class="site-header-inner">
        <div class="site-header-top">
          <div id="site-title" class="site-title">ğŸ“° Î•ÏÎºÎ¿Î»Î± ÎÎ­Î±</div>
        </div>
        <div class="site-subtitle">Î‘Ï€Î»Î® ÎºÎ±Î¹ Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼Î· ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î³Î¹Î± ÏŒÎ»Î¿Ï…Ï‚</div>
      </div>
    </div>
  </header>

  <main class="container mb-5">
    <div class="page-wrapper">
      <div class="mb-3">
        <a
          class="back-link btn btn-outline-light btn-sm rounded-pill d-inline-flex align-items-center gap-2"
          href="index.html"
        >
          <span aria-hidden="true">â†</span>
          <span>Î Î¯ÏƒÏ‰</span>
        </a>
      </div>
      <article class="article-main-card">
        <h1 id="article-title" class="article-main-title">Î¦Î¿ÏÏ„ÏÎ½Ï‰ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿â€¦</h1>

        <!-- Î•Î¹ÎºÏŒÎ½Î± Î¬ÏÎ¸ÏÎ¿Ï… Î±Ï€ÏŒ news.json (ÏŒÏ‡Î¹ Î³Î¹Î± lifestyle) -->
        <div id="article-image-wrapper" class="article-image-wrapper" style="display:none;">
          <img
            id="article-image"
            class="article-image"
            alt="Î•Î¹ÎºÏŒÎ½Î± Î¬ÏÎ¸ÏÎ¿Ï…"
            style="display: none;"
          />
        </div>

        <!-- Î’Î¯Î½Ï„ÎµÎ¿ Î¬ÏÎ¸ÏÎ¿Ï… -->
        <div id="article-video-wrapper" class="article-video-wrapper" style="display:none;">
          <div id="article-video-container"></div>
        </div>

        <div id="article-body" class="article-body">
          Î Î±ÏÎ±ÎºÎ±Î»Ï Ï€ÎµÏÎ¯Î¼ÎµÎ½Îµ Î»Î¯Î³Î¿â€¦
        </div>

        <!-- ÎšÎ¿Ï…Î¼Ï€Î¯ Î±ÎºÏÏŒÎ±ÏƒÎ·Ï‚ -->
        <div class="d-flex justify-content-end mt-3">
          <button id="listen-btn" type="button" class="btn btn-primary btn-listen">
            Î†ÎºÎ¿Ï… Ï„Î·Î½ ÎµÎ¯Î´Î·ÏƒÎ·
          </button>
        </div>

        <!-- ğŸ”š Î Î·Î³Î­Ï‚ ÎœÎŸÎÎŸ ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚ -->
        <div id="article-sources" class="sources-box"></div>
      </article>
    </div>
  </main>

  <script>
    const pageParams = new URLSearchParams(window.location.search);
    const sourceParam = pageParams.get("source") || "news";
    const idParam = pageParams.get("id");
    const topicParam = pageParams.get("topic");
    const categoryParam = pageParams.get("category");

    function escapeHtml(str) {
      if (!str) return "";
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }

    // Î‘Ï†Î±Î¹ÏÎ¿ÏÎ¼Îµ ÎµÎ½ÏŒÏ„Î·Ï„Î± "Î Î·Î³Î­Ï‚:" Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÎ¹ Î³ÏÎ¬ÏˆÎµÎ¹ Ï„Î¿ LLM
    function stripSourcesSection(text) {
      if (!text) return "";
      const markerIndex = text.lastIndexOf("Î Î·Î³Î­Ï‚:");
      if (markerIndex === -1) return text;
      return text.slice(0, markerIndex).trim();
    }

    function cleanMarkdown(text) {
      if (!text) return "";
      const withoutSources = stripSourcesSection(text);
      return withoutSources
        .replace(/\*\*(.+?)\*\*/g, "$1")
        .replace(/###\s*/g, "")
        .trim();
    }

    // ğŸ”Š ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Î³Î¹Î± play / pause / resume
    const ttsState = {
      utterance: null,
      isSpeaking: false,
      isPaused: false,
    };

    function setupTtsButton(buttonEl, title, bodyText) {
      const fullText = (title ? title + ". " : "") + (bodyText || "");

      buttonEl.textContent = "Î†ÎºÎ¿Ï… Ï„Î·Î½ ÎµÎ¯Î´Î·ÏƒÎ·";

      buttonEl.onclick = () => {
        if (!("speechSynthesis" in window)) {
          alert("ÎŸ Ï€ÎµÏÎ¹Î·Î³Î·Ï„Î®Ï‚ Î´ÎµÎ½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Î±Î½Î¬Î³Î½Ï‰ÏƒÎ· ÎºÎµÎ¹Î¼Î­Î½Î¿Ï….");
          return;
        }

        const synth = window.speechSynthesis;

        // Î±Î½ Î®Î´Î· Î¼Î¹Î»Î¬ÎµÎ¹ â†’ Ï€Î±ÏÏƒÎ·
        if (ttsState.isSpeaking && !ttsState.isPaused) {
          synth.pause();
          ttsState.isPaused = true;
          buttonEl.textContent = "Î£Ï…Î½Î­Ï‡Î¹ÏƒÎµ Ï„Î·Î½ ÎµÎ¯Î´Î·ÏƒÎ·";
          return;
        }

        // Î±Î½ ÎµÎ¯Î½Î±Î¹ ÏƒÎµ pause â†’ ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±
        if (ttsState.isSpeaking && ttsState.isPaused) {
          synth.resume();
          ttsState.isPaused = false;
          buttonEl.textContent = "Î Î±ÏÏƒÎ·";
          return;
        }

        // Î¾ÎµÎºÎ¹Î½Î¬Î¼Îµ Î½Î­Î± Î±Î½Î¬Î³Î½Ï‰ÏƒÎ·
        synth.cancel();
        const utterance = new SpeechSynthesisUtterance(fullText);
        utterance.lang = "el-GR";

        utterance.onstart = () => {
          ttsState.isSpeaking = true;
          ttsState.isPaused = false;
          buttonEl.textContent = "Î Î±ÏÏƒÎ·";
        };

        utterance.onend = () => {
          ttsState.isSpeaking = false;
          ttsState.isPaused = false;
          buttonEl.textContent = "Î†ÎºÎ¿Ï… Ï„Î·Î½ ÎµÎ¯Î´Î·ÏƒÎ·";
        };

        utterance.onerror = () => {
          ttsState.isSpeaking = false;
          ttsState.isPaused = false;
          buttonEl.textContent = "Î†ÎºÎ¿Ï… Ï„Î·Î½ ÎµÎ¯Î´Î·ÏƒÎ·";
        };

        ttsState.utterance = utterance;
        synth.speak(utterance);
      };
    }

    /* ---------- Background helpers ---------- */

    // ÏƒÎ¿Î²Î±ÏÎ­Ï‚ (digest) Î±Î½Î¬ topic
    function seriousBackgroundForTopic(topic) {
      switch (topic) {
        case "politics_economy":
          return "images/serious/politics.png";
        case "social":
          return "images/serious/social.png";
        case "world":
          return "images/serious/world.png";
        default:
          return null;
      }
    }

    function setSeriousBackground(topic) {
      const bgEl = document.getElementById("article-bg");
      if (!bgEl) return;
      const url = seriousBackgroundForTopic(topic);
      if (!url) {
        bgEl.style.display = "none";
        bgEl.style.backgroundImage = "";
        return;
      }
      bgEl.style.backgroundImage = "url('" + url + "')";
      bgEl.style.display = "block";
    }

    // lifestyle & Î±Ï€Î»Î­Ï‚ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚ Î±Î½Î¬ category
    function lifestyleBackgroundForCategory(category) {
      switch (category) {
        case "serious":
          return "images/categories/serious.jpg";
        case "sports":
          return "images/categories/sports.jpg";
        case "screen":
          return "images/categories/series.jpg";
        case "culture":
          return "images/categories/theatre.jpg";
        case "fun":
          return "images/categories/fun2.jpg";
        case "other":
          return "images/categories/other.jpg";
        case "all":
          return "images/categories/all.jpg";
        default:
          return null;
      }
    }

    function setLifestyleBackground(category) {
      const bgEl = document.getElementById("article-bg");
      if (!bgEl) return;
      const url = lifestyleBackgroundForCategory(category);
      if (!url) {
        bgEl.style.display = "none";
        bgEl.style.backgroundImage = "";
        return;
      }
      bgEl.style.backgroundImage = "url('" + url + "')";
      bgEl.style.display = "block";
    }

    // ğŸ”š Î Î·Î³Î­Ï‚ ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚, Î¼Îµ ÎµÎ¹ÎºÎ¿Î½Î¯Î´Î¹Î¿ â€“ Ï‰Ï‚ links Ï€ÏÎ¿Ï‚ site Î® Î¬ÏÎ¸ÏÎ¿
    function renderSourcesSection(container, article, fallbackText) {
      if (!container) return;

      const sources = Array.isArray(article?.sources) ? article.sources : [];
      const fallbackName = article?.sourceName || null;
      const fallbackUrl = article?.sourceUrl || null;

      const items = [];

      const hostnameFromUrl = (url) => {
        if (!url) return "";
        try {
          return new URL(url).hostname.replace(/^www\./, "");
        } catch {
          return url;
        }
      };

      if (sources.length) {
        for (const s of sources) {
          if (typeof s === "string") {
            const domain = s
              .replace(/^https?:\/\//i, "")
              .replace(/^www\./i, "")
              .trim();

            if (!domain) continue;

            const url = s.startsWith("http") ? s : "https://" + domain;
            const title = domain || hostnameFromUrl(url) || "Î Î·Î³Î®";
            items.push({ title, url });
            continue;
          }

          const url = s?.url || s?.sourceUrl || "";
          const title =
            s?.title ||
            s?.publisher ||
            s?.sourceName ||
            s?.source ||
            (url ? hostnameFromUrl(url) : "");

          if (!url && !title) continue;
          items.push({ title: title || "Î Î·Î³Î®", url });
        }
      }

      if (!items.length && fallbackUrl && fallbackUrl !== "#") {
        items.push({ title: fallbackName || "Î Î·Î³Î®", url: fallbackUrl });
      }

      if (!items.length && fallbackText) {
        items.push({ title: fallbackText, url: "" });
      }

      const validItems = items.filter((i) => i.title || i.url);
      if (!validItems.length) {
        container.innerHTML = "";
        container.style.display = "none";
        return;
      }

      const itemsHtml = validItems
        .map((item) => {
          const safeTitle = escapeHtml(item.title || "Î Î·Î³Î®");
          if (item.url) {
            const safeUrl = escapeHtml(item.url);
            return `<li><a href="${safeUrl}" target="_blank" rel="noopener">${safeTitle}</a></li>`;
          }
          return `<li>${safeTitle}</li>`;
        })
        .join("");

      container.innerHTML = `
        <p class="text-muted small mb-1">Î Î·Î³Î­Ï‚:</p>
        <ul class="small mb-0 ps-3">${itemsHtml}</ul>
      `;
      container.style.display = "block";
    }

    function renderArticleContent({
      article,
      titleEl,
      bodyEl,
      sourceEl,
      imageWrapper,
      imageEl,
      videoWrapper,
      videoContainer,
      listenBtn,
    }) {
      if (!article) return;

      const displayTitle = article.simpleTitle || article.title || "Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· ÏƒÎµ Î±Ï€Î»Î¬ Î»ÏŒÎ³Î¹Î±";
      const cleaned = cleanMarkdown(article.simpleText || "");

      if (article.category) {
        setLifestyleBackground(article.category);
      }

      titleEl.textContent = displayTitle;
      bodyEl.innerHTML = cleaned.replace(/\n/g, "<br/>");

      if (videoContainer) {
        videoContainer.innerHTML = "";
      }

      if (imageWrapper && imageEl) {
        if (article.imageUrl) {
          imageEl.src = article.imageUrl;
          imageEl.alt = displayTitle || "Î•Î¹ÎºÏŒÎ½Î± Î¬ÏÎ¸ÏÎ¿Ï…";
          imageEl.style.display = "block";
          imageWrapper.style.display = "block";
        } else {
          imageEl.removeAttribute("src");
          imageEl.alt = "";
          imageEl.style.display = "none";
          imageWrapper.style.display = "none";
        }
      }

      if (videoWrapper && videoContainer) {
        if (article.videoUrl) {
          let node;
          const url = article.videoUrl;

          if (/\.(mp4|webm|ogg)(\?|$)/i.test(url)) {
            node = document.createElement("video");
            node.className = "article-video";
            node.controls = true;

            const source = document.createElement("source");
            source.src = url;
            node.appendChild(source);
          } else {
            node = document.createElement("iframe");
            node.className = "article-video";
            node.src = url;
            node.loading = "lazy";
            node.allowFullscreen = true;
            node.setAttribute("frameborder", "0");
            node.setAttribute(
              "allow",
              "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            );
          }

          videoContainer.appendChild(node);
          videoWrapper.style.display = "block";
        } else {
          videoWrapper.style.display = "none";
        }
      }

      renderSourcesSection(sourceEl, article, null);

      document.title = displayTitle + " - Î•ÏÎºÎ¿Î»Î± ÎÎ­Î±";
      listenBtn.disabled = false;
      setupTtsButton(listenBtn, displayTitle, cleaned);
    }

    async function loadNewsArticle({
      idParam,
      titleEl,
      bodyEl,
      sourceEl,
      imageWrapper,
      imageEl,
      videoWrapper,
      videoContainer,
      listenBtn,
    }) {
      if (!idParam) {
        titleEl.textContent = "Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿";
        bodyEl.textContent = "Î›ÎµÎ¯Ï€ÎµÎ¹ Ï„Î¿ Î±Î½Î±Î³Î½Ï‰ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï… (id).";
        listenBtn.disabled = true;
        return;
      }

      try {
        const res = await fetch("news.json?cachebust=" + Date.now());
        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }

        const data = await res.json();
        const articles = (data && data.articles) || [];

        let article = articles.find((a) => String(a.id) === String(idParam));

        if (!article) {
          const idx = Number(idParam);
          if (!Number.isNaN(idx) && idx >= 0 && idx < articles.length) {
            article = articles[idx];
          }
        }

        if (!article) {
          titleEl.textContent = "Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿";
          bodyEl.textContent = "ÎŠÏƒÏ‰Ï‚ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿ Î½Î± Î­Ï‡ÎµÎ¹ Î±Ï†Î±Î¹ÏÎµÎ¸ÎµÎ¯.";
          listenBtn.disabled = true;
          return;
        }

        renderArticleContent({
          article,
          titleEl,
          bodyEl,
          sourceEl,
          imageWrapper,
          imageEl,
          videoWrapper,
          videoContainer,
          listenBtn,
        });
      } catch (err) {
        console.error(err);
        titleEl.textContent = "Î ÏÎ¿Î­ÎºÏ…ÏˆÎµ ÏƒÏ†Î¬Î»Î¼Î±";
        bodyEl.textContent = "Î”ÎµÎ½ Î¼Ï€ÏŒÏÎµÏƒÎ± Î½Î± Ï†Î¿ÏÏ„ÏÏƒÏ‰ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿: " + err.message;
        listenBtn.disabled = true;
      }
    }

    async function loadNewsCategoryArticle({
      categoryKey,
      titleEl,
      bodyEl,
      sourceEl,
      imageWrapper,
      imageEl,
      videoWrapper,
      videoContainer,
      listenBtn,
    }) {
      if (!categoryKey) {
        titleEl.textContent = "Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Î· ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±";
        bodyEl.textContent = "Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯Î± Î³Î¹Î± Ï„Î·Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±.";
        listenBtn.disabled = true;
        return;
      }

      setLifestyleBackground(categoryKey);

      try {
        const res = await fetch("news.json?cachebust=" + Date.now());
        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }

        const data = await res.json();
        const byCategory = data.articlesByCategory || {};
        const articles = byCategory[categoryKey] || [];
        const article = articles[0];

        if (!article) {
          titleEl.textContent = "Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Î¬ÏÎ¸ÏÎ¿ Î³Î¹Î± Î±Ï…Ï„Î® Ï„Î·Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±";
          bodyEl.textContent = "Î ÏÎ¿ÏƒÏ€Î¬Î¸Î·ÏƒÎµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿, Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Î¬ÏÎ¸ÏÎ¿.";
          listenBtn.disabled = true;
          sourceEl.innerHTML = "";
          return;
        }

        renderArticleContent({
          article,
          titleEl,
          bodyEl,
          sourceEl,
          imageWrapper,
          imageEl,
          videoWrapper,
          videoContainer,
          listenBtn,
        });
      } catch (err) {
        console.error("Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ news.json Î³Î¹Î± ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±:", err);
        titleEl.textContent = "Î ÏÎ¿Î­ÎºÏ…ÏˆÎµ ÏƒÏ†Î¬Î»Î¼Î±";
        bodyEl.textContent =
          "Î”ÎµÎ½ Î¼Ï€ÏŒÏÎµÏƒÎ± Î½Î± Ï†Î¿ÏÏ„ÏÏƒÏ‰ Ï„Î¹Ï‚ ÎµÎ¹Î´Î®ÏƒÎµÎ¹Ï‚ Î³Î¹Î± Ï„Î·Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±: " + err.message;
        listenBtn.disabled = true;
      }
    }

    async function loadSeriousArticle({
      idParam,
      topicParam,
      titleEl,
      bodyEl,
      sourceEl,
      listenBtn,
    }) {
      try {
        const digestRes = await fetch(
          "serious-digest.json?cachebust=" + Date.now()
        );
        if (!digestRes.ok) {
          throw new Error("HTTP " + digestRes.status);
        }
        const digestData = await digestRes.json();
        const digestArticles = Array.isArray(digestData.articles)
          ? digestData.articles
          : [];

        if (!digestArticles.length) {
          titleEl.textContent = "Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ ÏƒÎ¿Î²Î±ÏÎ­Ï‚ ÎµÎ¹Î´Î®ÏƒÎµÎ¹Ï‚";
          bodyEl.textContent =
            "Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Î¬ÏÎ¸ÏÎ¿ ÏƒÎ¿Î²Î±ÏÎ®Ï‚ ÎµÏ€Î¹ÎºÎ±Î¹ÏÏŒÏ„Î·Ï„Î±Ï‚ Î±Ï…Ï„Î® Ï„Î· ÏƒÏ„Î¹Î³Î¼Î®.";
          listenBtn.disabled = true;
          return;
        }

        let article = null;

        if (idParam) {
          article = digestArticles.find(
            (a) => String(a.id) === String(idParam)
          );
        }
        if (!article && topicParam) {
          article = digestArticles.find((a) => a.topic === topicParam);
        }
        if (!article) {
          article = digestArticles[0];
        }

        const displayTitle = article.title || "Î£Î¿Î²Î±ÏÎ® ÎµÎ¯Î´Î·ÏƒÎ·";
        const cleaned = cleanMarkdown(article.simpleText || "");

        // background Î±Î½Î¬ topic (serious digest)
        if (article.topic) {
          setSeriousBackground(article.topic);
        }

        titleEl.textContent = displayTitle;
        bodyEl.innerHTML = cleaned.replace(/\n/g, "<br/>");

        const digestHasSources = Array.isArray(article.sources)
          ? article.sources.length > 0
          : false;

        if (digestHasSources) {
          renderSourcesSection(sourceEl, article, null);
        } else if (article.mainArticleId) {
          try {
            const newsRes = await fetch("news.json?cachebust=" + Date.now());
            if (newsRes.ok) {
              const newsData = await newsRes.json();
              const allNews = Array.isArray(newsData.articles)
                ? newsData.articles
                : [];
              const mainSourceArticle = allNews.find(
                (a) => String(a.id) === String(article.mainArticleId)
              );
              if (mainSourceArticle) {
                renderSourcesSection(sourceEl, mainSourceArticle, null);
              } else {
                renderSourcesSection(
                  sourceEl,
                  { sources: [] },
                  "Î’Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÎµ Ï€Î¿Î»Î»Î­Ï‚ ÎµÎ»Î»Î·Î½Î¹ÎºÎ­Ï‚ ÎµÎ¹Î´Î·ÏƒÎµÎ¿Î³ÏÎ±Ï†Î¹ÎºÎ­Ï‚ Ï€Î·Î³Î­Ï‚."
                );
              }
            } else {
              renderSourcesSection(
                sourceEl,
                { sources: [] },
                "Î’Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÎµ Ï€Î¿Î»Î»Î­Ï‚ ÎµÎ»Î»Î·Î½Î¹ÎºÎ­Ï‚ ÎµÎ¹Î´Î·ÏƒÎµÎ¿Î³ÏÎ±Ï†Î¹ÎºÎ­Ï‚ Ï€Î·Î³Î­Ï‚."
              );
            }
          } catch (e) {
            console.error("Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ news.json Î³Î¹Î± Ï„Î¹Ï‚ Ï€Î·Î³Î­Ï‚:", e);
            renderSourcesSection(
              sourceEl,
              { sources: [] },
              "Î’Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÎµ Ï€Î¿Î»Î»Î­Ï‚ ÎµÎ»Î»Î·Î½Î¹ÎºÎ­Ï‚ ÎµÎ¹Î´Î·ÏƒÎµÎ¿Î³ÏÎ±Ï†Î¹ÎºÎ­Ï‚ Ï€Î·Î³Î­Ï‚."
            );
          }
        } else {
          renderSourcesSection(
            sourceEl,
            { sources: [] },
            "Î’Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÎµ Ï€Î¿Î»Î»Î­Ï‚ ÎµÎ»Î»Î·Î½Î¹ÎºÎ­Ï‚ ÎµÎ¹Î´Î·ÏƒÎµÎ¿Î³ÏÎ±Ï†Î¹ÎºÎ­Ï‚ Ï€Î·Î³Î­Ï‚."
          );
        }

        document.title = displayTitle + " - Î•ÏÎºÎ¿Î»Î± ÎÎ­Î±";

        // ğŸ§ setup play / pause / resume
        setupTtsButton(listenBtn, displayTitle, cleaned);
      } catch (err) {
        console.error(err);
        titleEl.textContent = "Î ÏÎ¿Î­ÎºÏ…ÏˆÎµ ÏƒÏ†Î¬Î»Î¼Î±";
        bodyEl.textContent =
          "Î”ÎµÎ½ Î¼Ï€ÏŒÏÎµÏƒÎ± Î½Î± Ï†Î¿ÏÏ„ÏÏƒÏ‰ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿ ÏƒÎ¿Î²Î±ÏÎ®Ï‚ ÎµÏ€Î¹ÎºÎ±Î¹ÏÏŒÏ„Î·Ï„Î±Ï‚: " +
          err.message;
        listenBtn.disabled = true;
      }
    }

    // âœ… Î¦ÏŒÏÏ„Ï‰ÏƒÎ· lifestyle Î¬ÏÎ¸ÏÎ¿Ï… Î±Ï€ÏŒ lifestyle.json
    async function loadLifestyleArticle({
      categoryParam,
      titleEl,
      bodyEl,
      sourceEl,
      listenBtn,
    }) {
      if (!categoryParam) {
        titleEl.textContent = "Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Î· ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±";
        bodyEl.textContent =
          "Î›ÎµÎ¯Ï€ÎµÎ¹ Î· Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯Î± Î³Î¹Î± Ï„Î¿ ÎµÎ¯Î´Î¿Ï‚ Ï„Î·Ï‚ lifestyle ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±Ï‚.";
        listenBtn.disabled = true;
        return;
      }

      // background Î±Î½Î¬ lifestyle ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±
      setLifestyleBackground(categoryParam);

      try {
        const res = await fetch("lifestyle.json?cachebust=" + Date.now());
        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }

        const data = await res.json();
        const list = Array.isArray(data.articles) ? data.articles : [];

        if (!list.length) {
          titleEl.textContent = "Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ lifestyle ÎµÎ¹Î´Î®ÏƒÎµÎ¹Ï‚";
          bodyEl.textContent =
            "Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ lifestyle Î¬ÏÎ¸ÏÎ¿ Î±Ï…Ï„Î® Ï„Î· ÏƒÏ„Î¹Î³Î¼Î®.";
          listenBtn.disabled = true;
          return;
        }

        // ğŸ” Î’ÏÎ¯ÏƒÎºÎ¿Ï…Î¼Îµ ÎœÎŸÎÎŸ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿ Î³Î¹Î± Ï„Î· ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±
        let article = list.find((a) => a.category === categoryParam);

        if (!article) {
          titleEl.textContent = "Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Î¬ÏÎ¸ÏÎ¿ Î³Î¹Î± Î±Ï…Ï„Î® Ï„Î·Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±";
          bodyEl.textContent =
            "Î£Î®Î¼ÎµÏÎ± Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ lifestyle Î¬ÏÎ¸ÏÎ¿ Î³Î¹Î± Î±Ï…Ï„Î® Ï„Î·Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±.";
          listenBtn.disabled = true;
          sourceEl.innerHTML = "";
          return;
        }

        const displayTitle = article.title || "Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· ÏƒÎµ Î±Ï€Î»Î¬ Î»ÏŒÎ³Î¹Î±";
        const cleaned = cleanMarkdown(article.simpleText || "");

        titleEl.textContent = displayTitle;
        bodyEl.innerHTML = cleaned.replace(/\n/g, "<br/>");

        // Î Î·Î³Î­Ï‚ ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚ (Î±Ï€ÏŒ Ï„Î¿ lifestyle.json)
        renderSourcesSection(sourceEl, article, null);

        document.title = displayTitle + " - Î•ÏÎºÎ¿Î»Î± ÎÎ­Î±";

        // ğŸ§ setup play / pause / resume
        setupTtsButton(listenBtn, displayTitle, cleaned);
      } catch (err) {
        console.error("Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ lifestyle.json:", err);
        titleEl.textContent = "Î ÏÎ¿Î­ÎºÏ…ÏˆÎµ ÏƒÏ†Î¬Î»Î¼Î±";
        bodyEl.textContent =
          "Î”ÎµÎ½ Î¼Ï€ÏŒÏÎµÏƒÎ± Î½Î± Ï†Î¿ÏÏ„ÏÏƒÏ‰ Ï„Î¿ lifestyle Î¬ÏÎ¸ÏÎ¿: " + err.message;
        listenBtn.disabled = true;
      }
    }

    async function loadArticle() {
      const titleEl = document.getElementById("article-title");
      const bodyEl = document.getElementById("article-body");
      const sourceEl = document.getElementById("article-sources");
      const imageWrapper = document.getElementById("article-image-wrapper");
      const imageEl = document.getElementById("article-image");
      const videoWrapper = document.getElementById("article-video-wrapper");
      const videoContainer = document.getElementById("article-video-container");
      const listenBtn = document.getElementById("listen-btn");

      if (sourceParam === "serious") {
        await loadSeriousArticle({
          idParam,
          topicParam,
          titleEl,
          bodyEl,
          sourceEl,
          listenBtn,
        });
      } else if (sourceParam === "lifestyle") {
        await loadLifestyleArticle({
          categoryParam,
          titleEl,
          bodyEl,
          sourceEl,
          listenBtn,
        });
      } else if (sourceParam && sourceParam !== "news" && !idParam) {
        await loadNewsCategoryArticle({
          categoryKey: sourceParam,
          titleEl,
          bodyEl,
          sourceEl,
          imageWrapper,
          imageEl,
          videoWrapper,
          videoContainer,
          listenBtn,
        });
      } else {
        await loadNewsArticle({
          idParam,
          titleEl,
          bodyEl,
          sourceEl,
          imageWrapper,
          imageEl,
          videoWrapper,
          videoContainer,
          listenBtn,
        });
      }
    }

    function setupBackLink(source) {
      const backLink = document.querySelector(".back-link");
      if (!backLink) return;

      if (source === "serious") {
        backLink.href = "category.html?category=serious";
      } else {
        backLink.href = "index.html";
      }
    }

    function setupSiteTitleReload() {
      const titleEl = document.querySelector(".site-title");
      if (!titleEl) return;

      titleEl.addEventListener("click", (event) => {
        event.preventDefault();
        window.location.reload();
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      setupSiteTitleReload();
      setupBackLink(sourceParam);
      loadArticle();
    });
  </script>
</body>
</html>


